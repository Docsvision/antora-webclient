// tag::linux[]
:of: {wc}а
:wt: webclient

= Установка и конфигурация сервера {wc}а

// Серверное расширение {wc} должно быть установлено на компьютер с _сервером {dv}_ до установки (настройки) модуля _{wc}_.

Пользователь, выполняющий настройку {dv}, должен являться локальным администратором (быть указанным в файле sudoers).

Если в {wc}е планируется работать с xref:archivemgmt:user:directory.adoc[функциями] модуля _{am}_, установите серверную часть модуля _{am}_ на компьютер с сервером {dv} *перед* установкой серверного расширения {wc}а.

Если {wc} уже установлен и планируется дополнительно установить модуль _{am}_ выполните следующие действия:

. Установите сначала модуль _{am}_.
. Затем xref:webclient:admin:update-module.adoc[обновите {wc}] с установкой компонентов управления архивом.

include::user:partial$excerpts.adoc[tags=noam]

[#linux]
== Установка на Linux

include::6.1@platform:admin:partial$install.adoc[]
+
Основные настройки, которые нужно сделать:
+
[source,json]
----
{
  "Docsvision": {
    "WebClient": {
      "Authentication": {
        "DefaultDomain": "DOMAIN.COM" <.>
      },
      "Server": {
        "SessionManagerConnection": {
          "ConnectionAddress": "http://dvserver.domain.com:5000" <.>
        }
      }
    },
    "ServiceId": "3ed2fd20-eaf9-8846-7089-b34dd8192328", <.>
    "SettingsService": {
      "ConnectionString": "http://storage-server.com:5200/api", <.>
      "ApiKey": "dvwebclientapikey" <.>
    }
  },
  "Ldap": { <.>
    "AuthType": "Basic", <.>
    "Credential": {
      "UserName": "account@domain.com", <.>
      "Password": "password" <.>
    }
  },
  "DataProtectCertificateThumbprint": "thumbprint", <.>
  "SystemUserAccount": "account@domain.com", <.>
  "SystemUserPassword": "password", <.>
}
----
<.> `DefaultDomain` -- домен по умолчанию в формате FQDN.
<.> `ConnectionAddress` -- адрес сервера {dv}.
<.> `Ldap` -- имя и пароль учётной записи, под которой процесс обращается к ActiveDirectory. +
Пароль можно указывать в открытом или в зашифрованном виде, см. подробнее о шифровании в документации по установке системы, раздел "xref:install-linux::appendix/account-protection.adoc[]"
+
<.> `AuthType` -- тип аутентификации: `Basic` -- аутентификация через LDAP (подробнее см. в документации модуля {pl} xref:6.1@platform:admin:config-domains.adoc[]), `Oauth` -- аутентификация через ЕСИА или Azure.
<.> `UserName` -- логин пользователя модуля для аутентификации LDAP.
<.> `Password` -- пароль учётной записи пользователя для аутентификации LDAP.
<.> `ServiceId` -- уникальный идентификатор данного экземпляра модуля, генерируется и записывается автоматически.
<.> `ConnectionString` -- адрес подключения к сервису настроек.
<.> `ApiKey` -- ключ приложения для подключения к сервису настроек.
<.> `DataProtectCertificateThumbprint` -- отпечаток закрытого ключа шифрования SHA1. +
Указывается без двоеточия, например, `D8602179888DC8402B393F11DCA16A3376DDF879`, см. подробнее в документации по установке системы, раздел "xref:install-linux::appendix/account-protection.adoc[]". +
Если шифровать пароль системной учётной записи не планируется, параметр можно удалить.
<.> `SystemUserAccount` -- имя системной учётной записи {dv} в формате UPN.
<.> `SystemUserPassword` -- пароль системной учётной записи рекомендуется хранить в зашифрованном виде. Подробнее про шифрование см. в документации по установке системы, раздел "xref:install-linux::appendix/account-protection.adoc[]".
// end::linux[]
+
. Запустите службу модуля:
+
[source,bash]
----
sudo systemctl start dvwebclient
----

[#windows]
== Установка серверного расширения на Windows

Пользователь, выполняющий установку, должен обладать правами администратора.

.Чтобы установить серверное расширение {wc}:
. *Запустите пакет установки* `{dv} web-client server extension.msi`.
+
. *Примите условия лицензионного соглашения*, чтобы продолжить установку.
+
.Условия лицензионного соглашения
image::install-server-license.png[Условия лицензионного соглашения]
+
// . Установите или обновите необходимые модули, если проверка не пройдена. xref:ROOT:requirements-dv.adoc#checkVersions[Подробнее] о проверке.
// +
// .Проверка требуемых модулей
// image::install-server-check.png[Проверка требуемых модулей]
// +
. Если требуется, измените каталог установки Расширения.
+
.Каталог установки Расширения
image::install-server-location.png[Каталог установки Расширения]
+
. Выберите необходимые компоненты установки.
+
.Выбор компонентов
image::install-server-components.png[Выбор компонентов]
+
// tag::components[]
* Компоненты {wc}а -- компоненты, необходимые для работы {wc}а. Обязательны к установке, неотключаемы.
* [[archive]]Компоненты Управления Архивом -- компоненты, открывающие возможность работы с функциями модуля _{am}_ в {wc}е. Обязательны к установке, если планируется работа с модулем _{am}_. Компоненты недоступны для установки, если не установлен модуль _{am}_.
+
NOTE: Работа с модулем _{am}_ поддерживается в модуле _{wc}_ {am-wc-req}.
+
ifdef::client[]
* {kvr} -- компоненты программы для работы с Web-разметками {kvr} может быть установлен вместе с сервером {wc}а и/или на отдельный компьютер (см. xref:install-server.adoc[Отдельная установка программы {kvr}]).
endif::client[]
* [[edi]]Компоненты модуля интеграции с операторами ЭДО -- компоненты {wc}а, необходимые для работы с модулем _{em}_.
+
Компоненты отображаются только если установлен _{em}_ версии {edi-v} и выше.
// end::components[]
+
. Нажмите на кнопку *Установить* и дождитесь завершения установки Расширения.
+
.Установка Расширения
image::install-server-confirm.png[Установка Расширения]
+
// . В процессе установки появится окно выбора БД. Выберите базы данных {dv}, в которые будет установлено расширение {wc}.
// +
// .Окно выбора баз данных для установки расширения
// image::install-db.png[Окно выбора баз данных для установки расширения]
// +
// Выберите все базы данных, к которым будет подключен {wc}, и нажмите кнопку *ОК*. База данных по умолчанию выделена жирным шрифтом.
// +
// [WARNING]
// ====
// * Если модуль устанавливается впервые и настройки ещё не были загружены в БД, в диалоге выберите *Отмена*.
// * {blank}
// +
// --
// include::partial$excerpts.adoc[tags=nonoyet]
// --
// ====
// +
// Дождитесь завершения установки расширения.
// +
// . Согласитесь с перезапуском сервисов {dv} при поступлении запроса.
// +
// .Диалог перезапуска сервисов {dv}
// image::install-restart-services.png[Диалог перезапуска сервисов {dv}]
// +
. Нажмите кнопку *Готово* для завершения работы мастера установки.
. Обновите БД через {cns}, подробнее процесс описан в документации модуля {pl}, раздел "xref:6.1@platform:console:db-update.adoc[]".

[#kvr-pu]
=== Установка программ {kvr} и Панель управления

[NOTE]
====
Системные требования приведены в пункте xref:ROOT:separate-layouts-install.adoc[Требования отдельной установки программы {kvr}].
====

// tag::kvr-pu[]
{kvr} и {pu} устанавливаются из пакета установки {wc}а.

Пользователь, выполняющий установку, должен обладать правами локального администратора.

.Чтобы установить {kvr}:
. Добавьте данные системной учётной записи {dv} в переменные окружения (если это не было выполнено ранее). +
Под этой учётной записью {kvr} и {pu} будут подключаться к серверу {dv}.
+
 setx DV_SystemUserAccount account@domain.com
 setx DV_SystemUserPassword password
+
. Запустите пакет установки `{dv} web-client.msi`.
. Примите условия лицензионного соглашения, чтобы продолжить установку.
. Если требуется, измените каталог установки.
+
.Каталог установки {wc}а
image::6.1@webclient:admin:install-client-location.png[Каталог установки {wc}а]
+
. Выберите для установки все компоненты {wc}а.
+
.Устанавливаемые компоненты модуля {wc}
image::6.1@webclient:admin:install-client-components.png[Устанавливаемые компоненты модуля {wc}]
// image::install-client-components-layouts.png[Устанавливаемые компоненты модуля {wc}]
// +
// . Укажите адрес подключения к StorageServer в формате `\http://имя-сервера/DocsVision`) и псевдоним БД {dv}, затем нажмите *Далее*.
// +
// .Настройки подключения к {dv}
// image::install-layouts-settings.png[Настройки подключения к {dv}]
// +
+
. Нажмите кнопку *Установить* и дождитесь завершения установки {wc}а.
+
В меню Пуск в группу {dv} будут добавлены ярлыки: {kvr} и {pu}.
+
. Укажите адрес подключения к серверу {dv} в файлах конфигурации:
+
WARNING: Обратите внимание, указанные ниже файлы конфигурации расположены в ОС Windows.
+
* `WebClientAdminConsole.appsettings.json` -- конфигурация программы _{pu}_.
* `WebLayoutsDesigner.appsettings.json` -- конфигурация программы _{kvr}_.
+
[source,json]
----
{
  "Docsvision": {
    "WebClient": {
      "Server": {
        "SessionManagerConnection": {
          "ConnectionAddress": "http://dvserver.domain.com:5000", <.>
          "BaseName": "alias" <.>
        }
      }
    }
  }
}
----
<.> Адрес сервера {dv}.
<.> Псевдоним БД, от имени которой будут запускаться программы {pu} и {kvr}.
+
. Откройте {pu} на вкладке _Решения_ и выполните импорт стандартных решений для корректной работы {wc}а.
// end::kvr-pu[]
